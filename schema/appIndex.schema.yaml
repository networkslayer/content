$schema: "https://json-schema.org/draft/2020-12/schema"

type: object

properties:
  uuid:
    description: >
      Unique identifier for the app.
    type: string
    format: uuid

  name:
    description: >
      The name of the app.
    type: string

  iconURL:
    description: >
      URL to the app icon image.
    type: string
    format: uri

  description:
    description: >
      Description of the app and its content.
    type: string

  author:
    description: >
      The person or organization that authored this app.
    type: string

  authorEmail:
    description: >
      The email address of the app author.
    type: string
    format: email

  datasets:
    description: >
      Optional list of datasets, separated into remote (URLs) and local (file paths) datasets.
      Remote datasets require SHA256 checksums for security and integrity verification.
      Local datasets are versioned via git commits; checksums are optional but recommended for verification.
    type: object
    properties:
      remote:
        description: >
          List of remote datasets from URLs. Each dataset must include a SHA256 checksum that will be verified upon download.
          If checksum verification fails, the app installation/update should be rejected.
        type: array
        items:
          type: object
          properties:
            path:
              type: string
              format: uri
              description: >
                URL path to the remote dataset file (http:// or https://).
            sha256sum:
              type: string
              pattern: "^[a-f0-9]{64}$"
              description: >
                SHA256 checksum of the file (64 hex characters). Required for security.
                The downloaded file must match this checksum or installation will fail.
            format:
              type: string
              description: >
                Format of the dataset file (e.g., "csv", "json").
          required:
            - path
            - sha256sum
            - format
      local:
        description: >
          List of local dataset files relative to the datasets directory.
          Files are versioned via git commits, providing immutability.
          SHA256 checksums are optional but can be used for additional verification.
        type: array
        items:
          type: object
          properties:
            path:
              type: string
              description: >
                File path relative to the datasets directory.
            format:
              type: string
              description: >
                Format of the dataset file (e.g., "csv", "json").
            sha256sum:
              type: string
              pattern: "^[a-f0-9]{64}$"
              description: >
                Optional SHA256 checksum for verification (64 hex characters).
                If provided, will be verified against the file in the repository.
          required:
            - path
            - format
    additionalProperties: false

  presets:
    description: >
      Optional list of presets, each with a source and sourceType. Both source and sourceType are required if presets are specified.
    type: array
    items:
      type: object
      properties:
        source:
          type: string
        sourceType:
          type: string
      required:
        - source
        - sourceType

  rules:
    description: >
      Optional list of rules, each with a name. Finds only YAML files in the rules directory.
    type: array
    items:
      type: object
      properties:
        name:
          type: string
      required:
        - name

  dashboards:
    description: >
      Optional list of dashboards, each with a name. Finds only YAML files in the dashboards directory.
      Screenshots are stored in a screenshots subdirectory within each dashboard directory.
    type: array
    items:
      type: object
      properties:
        name:
          type: string
        screenshots:
          description: >
            Optional list of screenshot names. Screenshots are PNG files stored in 
            dashboards/{name}/screenshots/ directory.
          type: array
          items:
            type: object
            properties:
              name:
                type: string
            required:
              - name
      required:
        - name

  notebooks:
    description: >
      Optional list of notebooks, each with a name. Finds only IPYNB files in the notebooks directory.
    type: array
    items:
      type: object
      properties:
        name:
          type: string
      required:
        - name

  tags:
    description: >
      Optional list of tags for categorizing the app.
    type: array
    items:
      type: string

  license:
    description: >
      License for the app (e.g., "Databricks", "MIT").
    type: string

  licenseUrl:
    description: >
      URL to the license document.
    type: string
    format: uri

required:
  - uuid
  - name
  - iconURL
  - description
  - author
  - authorEmail

anyOf:
  - required: ["presets"]
  - required: ["rules"]
  - required: ["dashboards"]
  - required: ["notebooks"]
  
  

